<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>VideoKYC Launcher</title>

<style>
body{
    margin:0;
    height:100vh;
    display:flex;
    justify-content:center;
    align-items:center;
    background:#f4f6f8;
    font-family:Arial;
}
.box{
    width:360px;
    background:#fff;
    padding:25px;
    border-radius:10px;
    box-shadow:0 4px 20px rgba(0,0,0,0.1);
}
input{
    width:100%;
    padding:10px;
    margin:8px 0;
    border:1px solid #ccc;
    border-radius:6px;
    box-sizing:border-box;
}
button{
    width:100%;
    padding:10px;
    background:#007bff;
    color:#fff;
    border:none;
    border-radius:6px;
    cursor:pointer;
}
.msg{
    margin-top:10px;
    text-align:center;
    font-size:13px;
    color:#d00;
}
</style>
</head>

<body>

<div class="box">
    <h3 style="text-align:center">VideoKYC Launch</h3>

    <input id="trackingId" placeholder="Tracking ID">
    <input id="groupId" placeholder="Group ID">
    <input id="agentId" placeholder="Agent ID">
    <input id="roomId" placeholder="Room ID" value="4000">
    <input id="displayName" placeholder="Display Name">

    <button onclick="launch()">Start KYC</button>

    <div class="msg" id="msg"></div>
</div>

<script>

function uuid() {
    return crypto.randomUUID();
}

async function launch() {

    const msg = document.getElementById("msg");
    msg.innerText = "Calling customer-data API...";

    const trackingId = document.getElementById("trackingId").value;
    const groupId = Number(document.getElementById("groupId").value);
    const agentId = Number(document.getElementById("agentId").value);
    const roomId = document.getElementById("roomId").value;
    const displayName = document.getElementById("displayName").value;

    const baseUrl = window.location.origin;

    const payload = {
        trackingId,
        displayName,
        welcomeMessage: "Hi...\nWelcome to the KYC process.",
        groupId,
        agentId,
        flow: "AgentAssisted",
        product: "Saving Accounts",
        subProduct: "AccountDetails",
        priority: 1,
        crn: trackingId,
        redirectUrl: baseUrl + "/multstream_janus_poc/index.html?roomId=" + roomId,
        data: [
            { name:"Mobile Number", value:"9940590727" },
            { name:"PANNumber", value:"pending" }
        ]
    };

    try {

        const res = await fetch(baseUrl + "/ims/videokyc/short/customer-data", {
            method: "POST",
            headers: {
                "client-id":"101",
                "Content-Type":"application/json",
                "x-request-id": uuid(),
                "timestamp": Date.now().toString(),
                "Signature":"GLg4naQWp6ZhbmCTA+8BVOTuxplX8K0cdR6PpdyNEas=",
                "apikey":"f0dac1d52a3742bba2c7562s332db7bb"
            },
            credentials:"include",
            body: JSON.stringify(payload)
        });

        if(!res.ok){
            msg.innerText = "API failed : " + res.status;
            return;
        }

        const json = await res.json();

        console.log("Customer Data Response:", json);

        // ðŸ”¥ IMPORTANT PART
        const callwaitUrl =
            json.callwaitUrl ||
            json.callWaitUrl ||
            json.data?.callwaitUrl;

        if(!callwaitUrl){
            msg.innerText = "callwaitUrl not found in response";
            return;
        }

        msg.innerText = "Redirecting to call...";
        window.location.href = callwaitUrl;

    } catch(e){
        console.error(e);
        msg.innerText = "Network error";
    }
}
</script>

</body>
</html>