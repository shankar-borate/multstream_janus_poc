<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>VideoCX Janus UI (TS) - Virtual BG + Screen Share</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link rel="icon" href="data:," />
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.4.1/dist/css/bootstrap.min.css"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
  <style>
    html, body { height: 100%; margin: 0; }
    body { background: #f5f7fb; overflow: hidden; min-height: 100dvh; }
    .stage { position: relative; width: 100%; height: 100%; min-height: 100dvh; }
    .remote-wrap { position:absolute; inset:0; display:flex; align-items:center; justify-content:center; padding:24px; }
    #remoteVideo { max-width:min(900px,85vw); max-height:min(520px,75vh); width:100%; height:auto; border-radius:10px; background:#000; box-shadow:0 10px 30px rgba(0,0,0,.15); }
    .local-pip { position:absolute; right:18px; bottom:18px; width:220px; height:140px; border-radius:10px; overflow:hidden; background:#000; border:2px solid #fff; z-index:5; box-shadow:0 10px 30px rgba(0,0,0,.18);}
    #localVideo { width:100%; height:100%; object-fit:cover; transform:scaleX(-1); }
    .controls { position:absolute; left:18px; top:18px; display:flex; flex-direction:column; gap:12px; z-index:10; }
    .ctrl-btn { width:44px; height:44px; border-radius:999px; border:0; color:#fff; font-size:18px; cursor:pointer; box-shadow:0 6px 18px rgba(0,0,0,.12); background:#2d7cf6; }
    .ctrl-btn.neutral{ background:#4b5563; }
    .ctrl-btn.danger{ background:#e11d48; }
    .ctrl-btn.green{ background:#16a34a; }
    .ctrl-btn.purple{ background:#7c3aed; }
    .ctrl-btn:disabled{ opacity:.45; cursor:not-allowed; }
    .reconnect { position:absolute; left:18px; bottom:60px; padding:10px 14px; border-radius:6px; border:0; background:#f97316; color:white; font-weight:600; box-shadow:0 6px 18px rgba(0,0,0,.12); z-index:30; }
    .media-io-panel{position:absolute;left:130px;bottom:60px;z-index:30;display:flex;flex-direction:column;gap:4px;padding:8px 10px;border-radius:8px;background:rgba(255,255,255,.95);border:1px solid rgba(148,163,184,.4);box-shadow:0 8px 18px rgba(15,23,42,.14);font:600 11px/1.3 ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Courier New",monospace;color:#0f172a;max-width:min(66vw,760px)}
    .media-io-bytes{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .media-io-issues{color:#b91c1c;min-height:14px}
    .status-matrix{position:absolute;left:18px;bottom:98px;z-index:30;display:grid;grid-template-columns:auto auto;column-gap:10px;row-gap:4px;padding:8px 10px;border-radius:8px;background:rgba(255,255,255,.95);border:1px solid rgba(148,163,184,.4);box-shadow:0 8px 18px rgba(15,23,42,.14);font:600 11px/1.3 ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Courier New",monospace;color:#0f172a;max-width:min(92vw,860px)}
    .status-matrix .label{color:#334155}
    .status-matrix .value{color:#0f172a}
    .call-meta{position:absolute;left:18px;bottom:18px;z-index:12;display:inline-flex;align-items:center;padding:6px 10px;border-radius:10px;background:rgba(255,255,255,.96);color:#111827;border:1px solid rgba(15,23,42,.12);box-shadow:0 8px 18px rgba(15,23,42,.12);font:600 12px/1.3 ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Courier New",monospace;white-space:nowrap;max-width:calc(100vw - 36px);overflow:hidden;text-overflow:ellipsis}
    @media (max-width: 768px){
      .call-meta{
        left:10px;
        right:auto;
        top:auto;
        bottom:calc(60px + env(safe-area-inset-bottom));
        transform:none;
        padding:5px 9px;
        font-size:11px;
        max-width:calc(100vw - 20px)
      }
      .reconnect{left:10px;bottom:calc(126px + env(safe-area-inset-bottom))}
      .media-io-panel{left:10px;bottom:calc(166px + env(safe-area-inset-bottom));max-width:calc(100vw - 20px)}
      .status-matrix{left:10px;bottom:calc(236px + env(safe-area-inset-bottom));max-width:calc(100vw - 20px)}
    }
    @media (max-width: 900px), (max-height: 560px){
      .remote-wrap{padding:12px 12px 24px}
      #remoteVideo{max-width:min(96vw,900px);max-height:min(62vh,380px);transform:translateY(-30px)}
      .local-pip{width:224px;height:140px;right:8px;bottom:calc(126px + env(safe-area-inset-bottom))}
      .reconnect{left:8px;bottom:calc(126px + env(safe-area-inset-bottom))}
      .media-io-panel{left:8px;bottom:calc(166px + env(safe-area-inset-bottom));max-width:calc(100vw - 16px)}
      .status-matrix{left:8px;bottom:calc(236px + env(safe-area-inset-bottom));max-width:calc(100vw - 16px)}
    }
    @media (max-height: 500px){
      #remoteVideo{transform:translateY(-34px)}
      .local-pip{width:210px;height:130px;right:8px;bottom:calc(136px + env(safe-area-inset-bottom))}
      .reconnect{left:8px;bottom:calc(136px + env(safe-area-inset-bottom))}
      .media-io-panel{left:8px;bottom:calc(176px + env(safe-area-inset-bottom));max-width:calc(100vw - 16px)}
      .status-matrix{left:8px;bottom:calc(246px + env(safe-area-inset-bottom));max-width:calc(100vw - 16px)}
      .call-meta{left:8px;bottom:calc(8px + env(safe-area-inset-bottom));max-width:calc(100vw - 16px)}
    }
    .status{position:absolute;top:14px;left:50%;transform:translateX(-50%);width:min(84vw,860px);background:rgba(255,255,255,.94);color:#111827;border:1px solid rgba(148,163,184,.38);border-radius:12px;padding:12px 14px;box-shadow:0 12px 24px rgba(15,23,42,.14);backdrop-filter:blur(6px);z-index:20;font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Courier New",monospace;text-align:center}
    .status #statusLine{font-size:14px;font-weight:700;line-height:1.25}
    .status .small{color:#4b5563;font-size:12px;margin-top:5px;line-height:1.3}
  
    .overlay-label{position:absolute;left:10px;top:10px;background:rgba(0,0,0,.55);color:#fff;padding:4px 8px;border-radius:999px;font-size:12px;z-index:6}
    .local-overlay{position:absolute;left:8px;top:8px}
    .remote-overlay{position:absolute;left:8px;top:8px}
    .ended-overlay{position:absolute;inset:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,.5);color:#fff;font-size:26px;font-weight:700;z-index:7}
    .quality-badge{position:absolute;right:8px;top:8px;background:rgba(0,0,0,.55);color:#fff;padding:4px 8px;border-radius:8px;font-size:12px;z-index:6;cursor:pointer}
    .quality-details{position:absolute;right:8px;top:34px;background:rgba(0,0,0,.7);color:#fff;padding:6px 8px;border-radius:8px;font-size:11px;display:none;z-index:6;max-width:260px}
    .quality-details.show{display:block}
    #remoteQuality,#remoteQualityDetails{display:none !important}
    .remote-fallback{position:absolute;inset:0;display:none;align-items:center;justify-content:center;z-index:3;pointer-events:none;background:linear-gradient(180deg, rgba(243,244,246,.68), rgba(229,231,235,.82))}
    .remote-fallback-card{width:min(280px,58vw);height:min(180px,34vh);border-radius:16px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:12px;background:rgba(255,255,255,.82);border:1px solid rgba(148,163,184,.32);box-shadow:0 16px 32px rgba(15,23,42,.12)}
    .remote-fallback-icon{width:64px;height:64px;border-radius:999px;display:flex;align-items:center;justify-content:center;border:1px solid rgba(156,163,175,.54);background:rgba(243,244,246,.95)}
    .remote-fallback-icon i{font-size:28px;color:#6b7280}
    .remote-fallback-dots{display:flex;gap:7px;margin-top:4px}
    .remote-fallback-dots span{width:8px;height:8px;border-radius:999px;background:#9ca3af;animation:fallbackPulse 1.25s ease-in-out infinite}
    .remote-fallback-dots span:nth-child(2){animation-delay:.15s}
    .remote-fallback-dots span:nth-child(3){animation-delay:.3s}
    @keyframes fallbackPulse{0%,100%{opacity:.28;transform:translateY(0)}50%{opacity:1;transform:translateY(-2px)}}

  </style>
</head>
<body>
<div class="stage">
  <div class="controls">
    <button id="btnMute" class="ctrl-btn" title="Mute/Unmute" disabled><i class="fa-solid fa-microphone"></i></button>
    <button id="btnUnpublish" class="ctrl-btn neutral" title="Stop Video" disabled><i class="fa-solid fa-video"></i></button>
    <button id="btnScreen" class="ctrl-btn green" title="Start Screen Share" disabled><i class="fa-solid fa-display"></i></button>
    <button id="btnVB" class="ctrl-btn purple" title="Toggle Virtual Background" disabled><i class="fa-solid fa-wand-magic-sparkles"></i></button>

    <!-- âœ… Added Recording button ABOVE End/Hangup (no other changes) -->
    <button id="btnRecord" title="Start Recording"> <i class="fa-solid fa-circle"></i></button>

    <button id="btnLeave" class="ctrl-btn danger" title="Hangup" disabled><i class="fa-solid fa-phone-slash"></i></button>
  </div>

  <button id="btnReconnect" class="reconnect" disabled>Re-Connect</button>
  <div id="mediaIoPanel" class="media-io-panel">
    <div id="mediaIoBytes" class="media-io-bytes">A(sent/recv): 0 / 0 | V(sent/recv): 0 / 0</div>
    <div id="mediaIoIssues" class="media-io-issues"></div>
  </div>
  <div id="statusMatrix" class="status-matrix">
    <div class="label">Remote receiving your video</div><div id="mRemoteRecvVideo" class="value">Unknown</div>
    <div class="label">Remote receiving your audio</div><div id="mRemoteRecvAudio" class="value">Unknown</div>
    <div class="label">Remote audio playback status</div><div id="mRemoteAudioPlayback" class="value">Unknown</div>
    <div class="label">Remote video playback status</div><div id="mRemoteVideoPlayback" class="value">Unknown</div>
    <div class="label">Local receiving your video</div><div id="mLocalRecvVideo" class="value">Unknown</div>
    <div class="label">Local receiving your audio</div><div id="mLocalRecvAudio" class="value">Unknown</div>
    <div class="label">Local audio playback status</div><div id="mLocalAudioPlayback" class="value">Unknown</div>
    <div class="label">Local video playback status</div><div id="mLocalVideoPlayback" class="value">Unknown</div>
  </div>
  <div id="callMeta" class="call-meta">RoomId: - | Name: -</div>

  <div class="status">
    <div id="statusLine">Idle</div>
    <div id="sessionInfo" class="small"></div>
  </div>

  <div class="remote-wrap">
    <video id="remoteVideo" autoplay playsinline></video>
    <div id="remoteFallback" class="remote-fallback">
      <div class="remote-fallback-card">
        <div class="remote-fallback-icon"><i class="fa-solid fa-video-slash"></i></div>
        <div class="remote-fallback-dots"><span></span><span></span><span></span></div>
      </div>
    </div>
    <div id="remoteOverlay" class="overlay-label remote-overlay">Remote</div>
    <div id="remoteQuality" class="quality-badge">Remote: -</div>
    <div id="remoteQualityDetails" class="quality-details">-</div>
    <div id="endedOverlay" class="ended-overlay">Call is ended</div>
  </div>

  <div class="local-pip">
    <video id="localVideo" autoplay playsinline muted></video>
    <div id="localOverlay" class="overlay-label local-overlay">Local</div>
    <div id="localQuality" class="quality-badge">Local: -</div>
    <div id="localQualityDetails" class="quality-details">-</div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/webrtc-adapter@8.2.3/out/adapter.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation/selfie_segmentation.js"></script>
<script src="https://janus.conf.meetecho.com/demos/janus.js"></script>
<script src="./dist/app.js"></script>
</body>
</html>
