{"version":3,"file":"app.js","sourceRoot":"","sources":["../src/core/Logger.ts","../src/core/EventBus.ts","../src/core/Types.ts","../src/core/UrlConfig.ts","../src/core/ParentBridge.ts","../src/core/http/HttpClient.ts","../src/core/clients/ims/ImsClient.ts","../src/core/clients/ims/ims.types.ts","../src/core/http/Cookie.ts","../src/core/http/Correlation.ts","../src/core/http/HttpError.ts","../src/core/http/HttpTypes.ts","../src/managers/ParticipantRoster.ts","../src/managers/MediaManager.ts","../src/managers/VirtualBackgroundManager.ts","../src/managers/ScreenShareManager.ts","../src/managers/NetworkQualityManager.ts","../src/managers/JanusGateway.ts","../src/managers/RemoteFeedManager.ts","../src/managers/CallController.ts","../src/ui/UIController.ts","../src/app.ts"],"names":[],"mappings":"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","sourcesContent":["class Logger {\n  static instance: Logger | null = null;\n\n  private static userName = \"User\";\n  private static remoteName = \"Remote\";\n\n  constructor(\n    private statusEl?: HTMLElement,\n    private infoEl?: HTMLElement\n  ){\n    Logger.instance = this;\n  }\n\n  static setUserName(name: string): void {\n    Logger.userName = (name && name.trim()) ? name.trim() : \"User\";\n    Logger.user(`Display name set to ${Logger.userName}`);\n  }\n\n  static setRemoteName(name: string): void {\n    Logger.remoteName = (name && name.trim()) ? name.trim() : \"Remote\";\n    Logger.remote(`Remote name set`);\n  }\n\n  // Instance UI updates\n  setStatus(msg: string): void {\n    if (this.statusEl) this.statusEl.textContent = msg;\n    Logger.user(msg);\n  }\n\n  setInfo(msg: string): void {\n    if (this.infoEl) this.infoEl.textContent = msg;\n    if (msg) Logger.flow(msg);\n  }\n\n  // Static UI updates (backward compatible)\n  static setStatus(msg: string): void { Logger.instance?.setStatus(msg); Logger.user(msg); }\n  static setInfo(msg: string): void { Logger.instance?.setInfo(msg); Logger.flow(msg); }\n  static info(msg: string): void { Logger.setInfo(msg); }\n  static warn(msg: string): void { console.log(`%cUser(${Logger.userName}): ${msg}`, \"color:#f59e0b;font-weight:bold\"); }\n  static error(msg: string, err?: unknown): void {\n    console.log(`%cUser(${Logger.userName}): ${msg}`, \"color:#fb7185;font-weight:bold\");\n    if (err) console.error(err);\n  }\n\n  // Friendly narration logs\n  static user(msg: string, data?: any): void {\n    console.log(`%cUser(${Logger.userName}): ${msg}`, \"color:#22c55e;font-weight:bold\", data ?? \"\");\n  }\n  static remote(msg: string, data?: any): void {\n    console.log(`%cRemote(${Logger.remoteName}): ${msg}`, \"color:#60a5fa;font-weight:bold\", data ?? \"\");\n  }\n  static net(msg: string, data?: any): void {\n    console.log(`%cNet: ${msg}`, \"color:#f59e0b;font-weight:bold\", data ?? \"\");\n  }\n  static flow(msg: string, data?: any): void {\n    console.log(`%cFlow: ${msg}`, \"color:#a78bfa;font-weight:bold\", data ?? \"\");\n  }\n}\n","type EventHandler<T=any> = (payload:T)=>void;\nclass EventBus {\n  private handlers = new Map<string, Set<EventHandler>>();\n  on<T=any>(event:string, h:EventHandler<T>){\n    if(!this.handlers.has(event)) this.handlers.set(event, new Set());\n    this.handlers.get(event)!.add(h as EventHandler);\n  }\n  emit<T=any>(event:string, payload:T){\n    const hs = this.handlers.get(event);\n    if(!hs) return;\n    hs.forEach(h=>{ try{ (h as EventHandler<T>)(payload);} catch(e){ console.error(e);} });\n  }\n}\n","type JoinConfig = { server:string; roomId:number; display:string; };\ntype ParticipantSnapshot = { roomId:number; participantIds:number[]; selfId?:number; };\ntype VcxServer = {server:string, client_id:string};\n","class UrlConfig {\n  static getString(k:string, fb:string=\"\"):string{\n    const v = new URLSearchParams(window.location.search).get(k);\n    return v && v.trim() ? v.trim() : fb;\n  }\n  static getNumber(k:string, fb:number):number{\n    const s = this.getString(k,\"\");\n    const n = parseInt(s,10);\n    return Number.isFinite(n) ? n : fb;\n  }\n  static getVcxServer():VcxServer {\n    return {\n      server:\"https://localhost.beta.videocx.io\",\n      client_id:\"101\"\n    }\n  }\n  static buildJoinConfig():JoinConfig{\n    const roomIdRaw = this.getString(\"roomId\", \"\");\n    if(!roomIdRaw){\n      alert (\"This call link is missing a room ID, so we cant join yet.Please open the full link again or add ?roomId=1234 to the URL.\")\n      throw new Error(\"Missing required query param: roomId\");\n    }\n    const roomId = parseInt(roomIdRaw, 10);\n    if(!Number.isFinite(roomId)){\n          alert (\"This call link is missing a room ID, so we cant join yet.Please open the full link again or add ?roomId=1234 to the URL.\")\n      throw new Error(\"Invalid query param: roomId must be a number\");\n    }\n    return {\n      server: this.getString(\"server\",\"wss://localhost.beta.videocx.io/mstream_janus\"),\n      roomId,\n      display: this.getString(\"name\",\"Guest\")\n    };\n  }\n}\n","class ParentBridge {\n  emit(evt:any){\n    try{\n      if(window.parent && window.parent !== window){\n        window.parent.postMessage(evt, \"*\");\n      }\n    }catch{}\n  }\n\n  onCommand(cb:(cmd:any)=>void){\n    window.addEventListener(\"message\", (ev)=>{\n      const d:any = ev.data;\n      if(d && d.type) cb(d);\n    });\n  }\n}\n","// import { Cookie } from \"./Cookie\";\n// import { Correlation } from \"./Correlation\";\n// import { HttpError } from \"./HttpError\";\n// import type { HttpRequest, HttpResponse } from \"./HttpTypes\";\n\n/**\n * VCX browser HTTP client:\n * - Sends cookies (credentials: include) by default (needed for IMS/OWB token cookies)\n * - Adds X-Request-Id and X-XSRF-Token (from cookies) automatically when available\n * - Adds client-id header\n * - Provides timeout via AbortController\n * - Normalizes errors to HttpError\n */\nclass HttpClient {\n  constructor(\n    private readonly baseUrl: string,\n    private readonly clientId: string,\n    private readonly defaultTimeoutMs = 15000\n  ) {}\n\n  async request<T>(req: Omit<HttpRequest, \"url\"> & { path: string }): Promise<HttpResponse<T>> {\n    const requestId = Correlation.newId();\n    const url = this.buildUrl(this.baseUrl, req.path, req.query);\n\n    const controller = new AbortController();\n    const timeoutMs = req.timeoutMs ?? this.defaultTimeoutMs;\n    const t0 = performance.now();\n    const timeoutHandle = window.setTimeout(() => controller.abort(), timeoutMs);\n\n    const xsrf =\n      Cookie.get(\"xsrf-token\") ||\n      Cookie.get(\"XSRF-TOKEN\") ||\n      \"\";\n\n    const headers: Record<string, string> = {\n      \"accept\": \"application/json\",\n      ...(req.body !== undefined ? { \"content-type\": \"application/json; charset=utf-8\" } : {}),\n      \"client-id\": this.clientId,\n      \"x-request-id\": requestId,\n      ...(xsrf ? { \"x-xsrf-token\": xsrf } : {}),\n      ...(req.headers ?? {}),\n    };\n\n    try {\n      const res = await fetch(url, {\n        method: req.method,\n        headers,\n        body: req.body !== undefined ? JSON.stringify(req.body) : undefined,\n        credentials: req.credentials ?? \"include\",\n        signal: controller.signal,\n      });\n\n      const ms = Math.round(performance.now() - t0);\n\n      const text = await res.text().catch(() => \"\");\n      const data: any = text ? this.safeJson(text) : null;\n\n      if (!res.ok) {\n        throw new HttpError(\n          `HTTP ${res.status} ${req.method} ${req.path}`,\n          res.status,\n          requestId,\n          url,\n          data\n        );\n      }\n\n      return { status: res.status, data: data as T, headers: res.headers, requestId, url, ms };\n    } catch (e: any) {\n      const ms = Math.round(performance.now() - t0);\n\n      if (e?.name === \"AbortError\") {\n        throw new HttpError(\n          `Timeout (${timeoutMs}ms) ${req.method} ${req.path}`,\n          408,\n          requestId,\n          url,\n          { timeoutMs, ms }\n        );\n      }\n      if (e instanceof HttpError) throw e;\n      throw new HttpError(\n        `Network error ${req.method} ${req.path}`,\n        undefined,\n        requestId,\n        url,\n        e\n      );\n    } finally {\n      window.clearTimeout(timeoutHandle);\n    }\n  }\n\n  async getJson<T>(path: string, query?: HttpRequest[\"query\"], headers?: Record<string, string>): Promise<HttpResponse<T>> {\n    return this.request<T>({ method: \"GET\", path, query, headers });\n  }\n\n  private buildUrl(baseUrl: string, path: string, query?: HttpRequest[\"query\"]): string {\n    const u = new URL(path, baseUrl);\n    if (query) {\n      for (const [k, v] of Object.entries(query)) {\n        if (v === undefined || v === null) continue;\n        u.searchParams.set(k, String(v));\n      }\n    }\n    return u.toString();\n  }\n\n  private safeJson(text: string): any {\n    try { return JSON.parse(text); } catch { return text; }\n  }\n}\n","// import { HttpClient } from \"../../http/HttpClient\";\n// import type { ImsSettingRow, MediaConstraintsPayload } from \"./ims.types\";\n\nclass ImsClient {\n  constructor(private readonly http: HttpClient) {}\n\n  /**\n   * GET /ims/users/media-constraints\n   * Returns row with a JSON string in `value`. We parse it and return the payload.\n   */\n  async getMediaConstraints(): Promise<MediaConstraintsPayload> {\n    const res = await this.http.getJson<ImsSettingRow>(\"/ims/users/media-constraints\");\n    const row = res.data;\n\n    // value is a JSON string (escaped)\n    const payload: MediaConstraintsPayload = JSON.parse(row.value);\n    return payload;\n  }\n}\n","interface ImsSettingRow {\n  name: string;\n  /** JSON string */\n  value: string;\n}\n\n/** Parsed payload inside `value` */\ninterface MediaConstraintsPayload {\n  MEDIA_CONSTRAINTS?: {\n    WEB_MEDIA_CONSTRAINTS?: any[];\n    WEB_MEDIA_CONSTRAINTS_GU?: any[];\n    MOBILE_MEDIA_CONSTRAINTS?: any[];\n  };\n  PC_CONFIG?: RTCConfiguration;\n  PC_CONFIG_FF?: any;\n  videochat?: any;\n  chimeMediaConstraints?: any;\n}\n\n/**\n * Pick best constraint object for browser/device.\n * You can tweak strategy later (e.g., based on isMobile, isSafari, bandwidth, etc.)\n */\nfunction pickMediaConstraints(payload: MediaConstraintsPayload, isMobile: boolean): MediaStreamConstraints {\n  const mc = payload.MEDIA_CONSTRAINTS ?? {};\n  if (isMobile) {\n    const list = mc.MOBILE_MEDIA_CONSTRAINTS ?? [];\n    return (list[0] as MediaStreamConstraints) ?? { audio: true, video: true };\n  }\n  const list = mc.WEB_MEDIA_CONSTRAINTS ?? [];\n  return (list[0] as MediaStreamConstraints) ?? { audio: true, video: true };\n}\n","class Cookie {\n  /** Get cookie value by name (decoded). Returns null if missing. */\n  static get(name: string): string | null {\n    const safe = name.replace(/[-.$?*|{}()\\[\\]\\\\\\/\\+^]/g, \"\\\\$&\");\n    const match = document.cookie.match(new RegExp(`(?:^|; )${safe}=([^;]*)`));\n    return match ? decodeURIComponent(match[1]) : null;\n  }\n}\n","class Correlation {\n  /** Browser-safe request id */\n  static newId(): string {\n    const c: any = crypto as any;\n    if (c && typeof c.randomUUID === \"function\") return c.randomUUID();\n    return `${Date.now()}-${Math.random().toString(16).slice(2)}`;\n  }\n}\n","class HttpError extends Error {\n  constructor(\n    message: string,\n    public readonly status?: number,\n    public readonly requestId?: string,\n    public readonly url?: string,\n    public readonly details?: unknown\n  ) {\n    super(message);\n    this.name = \"HttpError\";\n  }\n}\n","type HttpMethod = \"GET\" | \"POST\" | \"PUT\" | \"PATCH\" | \"DELETE\";\n\ninterface HttpRequest {\n  method: HttpMethod;\n  /** Absolute URL */\n  url: string;\n  headers?: Record<string, string>;\n  query?: Record<string, string | number | boolean | null | undefined>;\n  body?: unknown;\n  timeoutMs?: number;\n  /** default: include (send cookies) */\n  credentials?: RequestCredentials;\n}\n\ninterface HttpResponse<T> {\n  status: number;\n  data: T;\n  headers: Headers;\n  requestId: string;\n  url: string;\n  ms: number;\n}\n","class ParticipantRoster {\n  private ids = new Set<number>();\n  private selfId?: number;\n  setSelf(id:number){ this.selfId=id; this.ids.add(id); }\n  add(id:number){ this.ids.add(id); }\n  remove(id:number){ this.ids.delete(id); }\n  snapshot(roomId:number):ParticipantSnapshot{\n    return { roomId, participantIds:Array.from(this.ids.values()), selfId:this.selfId };\n  }\n  reset(){ this.ids.clear(); this.selfId=undefined; }\n}\n","class MediaManager {\n  private localPreviewStream: MediaStream | null = null;\n\n  setLocalTrack(video: HTMLVideoElement, track: MediaStreamTrack){\n    if(!this.localPreviewStream) this.localPreviewStream = new MediaStream();\n    this.localPreviewStream.getTracks().forEach(t=>this.localPreviewStream!.removeTrack(t));\n    this.localPreviewStream.addTrack(track);\n    video.srcObject = this.localPreviewStream;\n    video.muted = true;\n    video.play().catch(()=>{});\n  }\n\n  setRemoteTrack(video: HTMLVideoElement, track: MediaStreamTrack){\n    const ms = (video.srcObject as MediaStream) || new MediaStream();\n    ms.addTrack(track);\n    video.srcObject = ms;\n    video.play().catch(()=>{});\n  }\n\n  clearLocal(video: HTMLVideoElement){\n    const ms = video.srcObject as MediaStream | null;\n    if(ms) ms.getTracks().forEach(t=>t.stop());\n    video.srcObject = null;\n    this.localPreviewStream = null;\n  }\n\n  clearRemote(video: HTMLVideoElement){\n    const ms = video.srcObject as MediaStream | null;\n    if(ms) ms.getTracks().forEach(t=>t.stop());\n    video.srcObject = null;\n  }\n}\n","class VirtualBackgroundManager {\n  private bg = new Image();\n  private seg: any = null;\n  private canvas: HTMLCanvasElement;\n  private ctx: CanvasRenderingContext2D;\n  private inVideo: HTMLVideoElement;\n  private running = false;\n  private srcStream: MediaStream | null = null;\n  private outStream: MediaStream | null = null;\n\n  // IMPORTANT: put virtual.jpeg next to index.html\n  private bgUrl = this.getBgUrl();\n\n  constructor(){\n    // For local file (same origin), no crossOrigin needed\n    this.bg.src = this.bgUrl;\n\n    this.canvas = document.createElement(\"canvas\");\n    const c = this.canvas.getContext(\"2d\");\n    if(!c) throw new Error(\"No canvas 2d\");\n    this.ctx = c;\n\n    this.inVideo = document.createElement(\"video\");\n    this.inVideo.autoplay = true;\n    this.inVideo.playsInline = true;\n    this.inVideo.muted = true;\n  }\n\nprivate getBgUrl(): string {\n  // Same folder as index.html (works even with query params)\n  // http://localhost/app/index.html?x=1 -> http://localhost/app/virtual.jpeg\n  try {\n    return new URL(\"./virtual.jpeg\", window.location.href).toString();\n  } catch {\n    return \"./virtual.jpeg\";\n  }\n}\n\n    private async ensureBgLoaded(): Promise<void> {\n    const img = this.bg;\n    const url = this.bgUrl;\n    if (!img.src || img.src !== url) {\n      img.crossOrigin = \"anonymous\";\n      img.src = url;\n    }\n    Logger.user(`VB background loading: ${img.src}`);\n    if (img.complete && img.naturalWidth > 0) {\n      Logger.user(`VB background already loaded: w=${img.naturalWidth} h=${img.naturalHeight}`);\n      return;\n    }\n    await new Promise<void>((resolve) => {\n      img.onload = () => {\n        Logger.user(`VB background loaded OK: w=${img.naturalWidth} h=${img.naturalHeight}`);\n        resolve();\n      };\n      img.onerror = () => {\n        Logger.user(`VB background FAILED to load: ${img.src}`);\n        resolve();\n      };\n    });\n  }\n\n  async enable(stream: MediaStream): Promise<MediaStream>{\n    this.srcStream = stream;\n    this.inVideo.srcObject = stream;\n    await this.inVideo.play().catch(()=>{});\n\n    await this.ensureBgLoaded();\n\n    if(!this.seg){\n      this.seg = new SelfieSegmentation({\n        locateFile: (file: string) => `https://cdn.jsdelivr.net/npm/@mediapipe/selfie_segmentation/${file}`\n      });\n      this.seg.setOptions({ modelSelection: 1 });\n      this.seg.onResults((r: any) => this.onResults(r));\n    }\n\n    this.running = true;\n    this.loop();\n\n    // 24 fps is OK for mobile; adjust if needed\n    this.outStream = this.canvas.captureStream(24);\n    Logger.user(\"Virtual background enabled\");\n    Logger.setStatus(\"Virtual background enabled\");\n    return this.outStream;\n  }\n\n  disable(){\n    this.running = false;\n    this.outStream = null;\n    Logger.user(\"Virtual background disabled\");\n    Logger.setStatus(\"Virtual background disabled\");\n  }\n\n  getSourceStream(){ return this.srcStream; }\n\n  private async loop(){\n    while(this.running){\n      if(this.inVideo.readyState >= 2){\n        await this.seg.send({ image: this.inVideo });\n      }\n      await new Promise(r=>setTimeout(r, 33));\n    }\n  }\n\n  private onResults(results: any){\n    const w = (results.image && results.image.width) || this.inVideo.videoWidth || 640;\n    const h = (results.image && results.image.height) || this.inVideo.videoHeight || 480;\n    if(!w || !h) return;\n\n    if(this.canvas.width !== w) this.canvas.width = w;\n    if(this.canvas.height !== h) this.canvas.height = h;\n\n    const ctx = this.ctx;\n    ctx.clearRect(0,0,w,h);\n\n    // 1) Draw the camera frame\n    ctx.globalCompositeOperation = \"source-over\";\n    ctx.drawImage(results.image, 0, 0, w, h);\n\n    // 2) Keep ONLY the person using segmentation mask\n    // segmentationMask: white = person, black = background\n    ctx.globalCompositeOperation = \"destination-in\";\n    ctx.drawImage(results.segmentationMask, 0, 0, w, h);\n\n    // 3) Draw background BEHIND the person\n    ctx.globalCompositeOperation = \"destination-over\";\n    if(this.bg.complete && this.bg.naturalWidth > 0){\n      ctx.drawImage(this.bg, 0, 0, w, h);\n    } else {\n      // fallback: dark fill if image not loaded\n      ctx.fillStyle = \"#0b1020\";\n      ctx.fillRect(0,0,w,h);\n    }\n\n    ctx.globalCompositeOperation = \"source-over\";\n  }\n}\n","class ScreenShareManager {\n  private stream: MediaStream | null = null;\n\n  async start(): Promise<MediaStream>{\n    this.stream = await navigator.mediaDevices.getDisplayMedia({ video:true, audio:false });\n    return this.stream;\n  }\n\n  stop(){\n    if(this.stream){\n      this.stream.getTracks().forEach(t=>t.stop());\n      this.stream = null;\n    }\n  }\n}\n","type NetQuality = \"High\"|\"Medium\"|\"Low\";\n\nclass NetworkQualityManager {\n  private timer:number|null=null;\n\n  start(cb:(local:NetQuality, remote:NetQuality, details:string)=>void){\n    this.stop();\n    this.timer = window.setInterval(()=>{\n      // synthetic values (replace with getStats wiring)\n      const rtt = Math.round(30 + Math.random()*200);\n      const jitter = Math.round(3 + Math.random()*60);\n      const loss = Math.round(Math.random()*8);\n      const bitrate = Math.round(150 + Math.random()*1000);\n\n      const q = this.calc(rtt,jitter,loss,bitrate);\n      const details = `rtt=${rtt}ms jitter=${jitter}ms loss=${loss}% bitrate=${bitrate}kbps`;\n      cb(q,q,details);\n    }, 3000);\n  }\n\n  stop(){\n    if(this.timer!=null){ clearInterval(this.timer); this.timer=null; }\n  }\n\n  private calc(rtt:number,jitter:number,loss:number,bitrate:number):NetQuality{\n    let score=0;\n    if(rtt<120) score++;\n    if(jitter<30) score++;\n    if(loss<2) score++;\n    if(bitrate>400) score++;\n    if(score>=4) return \"High\";\n    if(score>=2) return \"Medium\";\n    return \"Low\";\n  }\n}\n","class JanusGateway {\n  private janus: any = null;\n  private publisher: any = null;\n  private opaqueId = \"videocx-ui-\" + Janus.randomString(12);\n\n  constructor() {}\n\n  init() {\n    Janus.init({\n      debug: \"all\",\n      callback: () => {\n        Logger.setStatus(\"Janus initialized\");\n        Logger.user(\"Janus.init done\");\n      }\n    });\n  }\n\n  /**\n   * Creates Janus session.\n   * IMPORTANT: pass iceServers from IMS payload.PC_CONFIG.iceServers\n   */\n  createSession(\n    server: string,\n    iceServers: RTCIceServer[] | undefined,\n    ok: () => void,\n    destroyed: () => void\n  ) {\n    Logger.setStatus(\"Creating Janus session...\");\n    Logger.user(`Creating Janus session: ${server}`);\n\n    this.janus = new Janus({\n      server,\n\n      //  TURN/STUN config (from IMS)\n      // Janus will use these ICE servers for the underlying RTCPeerConnection(s)\n      iceServers: iceServers ?? [],\n\n      success: ok,\n      error: (e: any) => {\n        Logger.setStatus(\"Janus error: \" + JSON.stringify(e));\n        Logger.user(\"Janus session create error: \" + JSON.stringify(e));\n      },\n      destroyed: () => {\n        Logger.user(\"Janus session destroyed\");\n        destroyed();\n      }\n    });\n  }\n\n  attachPublisher(\n    onAttached: (h: any) => void,\n    onMessage: (msg: any, jsep: any) => void,\n    onLocalTrack: (track: MediaStreamTrack, on: boolean) => void,\n    onCleanup: () => void\n  ) {\n    if (!this.janus) {\n      Logger.setStatus(\"Janus not ready\");\n      Logger.user(\"attachPublisher called but Janus session is null\");\n      return;\n    }\n\n    Logger.user(\"Attaching videoroom publisher plugin...\");\n\n    this.janus.attach({\n      plugin: \"janus.plugin.videoroom\",\n      opaqueId: this.opaqueId,\n      success: (h: any) => {\n        this.publisher = h;\n        Logger.user(`Publisher plugin attached. handleId=${h.getId?.() ?? \"?\"}`);\n        onAttached(h);\n      },\n      error: (e: any) => {\n        Logger.setStatus(\"Attach error: \" + JSON.stringify(e));\n        Logger.user(\"Attach error: \" + JSON.stringify(e));\n      },\n      onmessage: (msg: any, jsep: any) => {\n        onMessage(msg, jsep);\n      },\n      onlocaltrack: (track: MediaStreamTrack, on: boolean) => {\n        onLocalTrack(track, on);\n      },\n      oncleanup: () => {\n        Logger.user(\"Publisher plugin cleanup\");\n        onCleanup();\n      }\n    });\n  }\n\n  getJanus() {\n    return this.janus;\n  }\n\n  getOpaqueId() {\n    return this.opaqueId;\n  }\n\n  destroy() {\n    Logger.user(\"Destroying Janus session + publisher...\");\n\n    try {\n      this.publisher?.detach?.();\n    } catch {}\n\n    this.publisher = null;\n\n    try {\n      this.janus?.destroy?.();\n    } catch {}\n\n    this.janus = null;\n  }\n}\n/*class JanusGateway {\n  private janus:any = null;\n  private publisher:any = null;\n  private opaqueId = \"videocx-ui-\" + Janus.randomString(12);\n\n  constructor(){}\n\n  init(){\n    Janus.init({ debug:\"all\", callback: ()=>Logger.setStatus(\"Janus initialized\") });\n  }\n\n  createSession(server:string, ok:()=>void, destroyed:()=>void){\n    Logger.setStatus(\"Creating Janus session...\");\n    Logger.user(`Creating Janus session: ${server}`);\n      this.janus = new Janus({\n      server,\n      success: ok,\n      error: (e:any)=>Logger.setStatus(\"Janus error: \"+JSON.stringify(e)),\n      destroyed\n    });\n  }\n\n  attachPublisher(\n    onAttached:(h:any)=>void,\n    onMessage:(msg:any,jsep:any)=>void,\n    onLocalTrack:(track:MediaStreamTrack,on:boolean)=>void,\n    onCleanup:()=>void\n  ){\n    this.janus.attach({\n      plugin:\"janus.plugin.videoroom\",\n      opaqueId:this.opaqueId,\n      success:(h:any)=>{ this.publisher=h; onAttached(h); },\n      error:(e:any)=>Logger.setStatus(\"Attach error: \"+JSON.stringify(e)),\n      onmessage:onMessage,\n      onlocaltrack:onLocalTrack,\n      oncleanup:onCleanup\n    });\n  }\n\n  getJanus(){ return this.janus; }\n  getOpaqueId(){ return this.opaqueId; }\n\n  destroy(){\n    try{ this.publisher?.detach(); }catch{}\n    this.publisher = null;\n    try{ this.janus?.destroy(); }catch{}\n    this.janus = null;\n  }\n}*/\n","class RemoteFeedManager {\n  private feeds = new Map<number, any>();\n\n  constructor(\n    private janus:any,\n    private roomId:number,\n    private privateId:number,\n    private opaqueId:string,\n    private media:MediaManager,\n    private remoteVideo:HTMLVideoElement\n  ){}\n\n  addFeed(feedId:number){\n    if(this.feeds.has(feedId)) return;\n    let remoteHandle:any = null;\n\n    this.janus.attach({\n      plugin:\"janus.plugin.videoroom\",\n      opaqueId:this.opaqueId,\n      success:(h:any)=>{\n        remoteHandle=h;\n        this.feeds.set(feedId,h);\n        h.send({ message:{ request:\"join\", room:this.roomId, ptype:\"subscriber\", feed:feedId, private_id:this.privateId }});\n      },\n      error:(e:any)=>Logger.setStatus(\"Remote attach error: \"+JSON.stringify(e)),\n      onmessage:(msg:any,jsep:any)=>{\n        if(jsep){\n          remoteHandle.createAnswer({\n            jsep,\n            tracks:[{type:\"audio\",capture:false,recv:true},{type:\"video\",capture:false,recv:true}],\n            success:(ans:any)=>remoteHandle.send({ message:{ request:\"start\", room:this.roomId }, jsep:ans }),\n            error:(e:any)=>Logger.setStatus(\"Remote answer error: \"+JSON.stringify(e))\n          });\n        }\n      },\n      onlocaltrack:()=>{},\n      onremotetrack:(track:MediaStreamTrack,_mid:string,on:boolean)=>{\n        if(!on) return;\n        this.media.setRemoteTrack(this.remoteVideo, track);\n      },\n      oncleanup:()=>this.removeFeed(feedId)\n    });\n  }\n\n  removeFeed(id:number){\n    const h = this.feeds.get(id);\n    if(h){ try{h.detach();}catch{} this.feeds.delete(id); }\n  }\n\n  cleanupAll(){\n    this.feeds.forEach(h=>{ try{h.detach();}catch{} });\n    this.feeds.clear();\n  }\n}\n","// import { HttpClient } from \"../core/http/HttpClient\";\n// import { ImsClient } from \"../core/clients/ims/ImsClient\";\n\nclass CallController {\n\n  private gateway: JanusGateway;\n  private media: MediaManager;\n  private roster = new ParticipantRoster();\n\n  private plugin: any = null;\n  private privateId: number | null = null;\n  private selfId: number | null = null;\n  private remoteFeeds: RemoteFeedManager | null = null;\n\n  private joinedRoom = false;\n  private roomCreateAttempted = false;\n\n  private cameraStream: MediaStream | null = null;\n  private screenEnabled = false;\n  private vbEnabled = false;\n\n  private screenManager = new ScreenShareManager();\n  private vbManager: VirtualBackgroundManager;\n\n  //  CLEAN recording state\n  private recording = false;\n  private currentRecordingId: string | null = null;\n  private currentRoomId: number | null = null;\n\n  constructor(\n    private bus: EventBus,\n    private localVideo: HTMLVideoElement,\n    private remoteVideo: HTMLVideoElement\n  ) {\n    this.gateway = new JanusGateway();\n    this.media = new MediaManager();\n    this.vbManager = new VirtualBackgroundManager();\n    this.gateway.init();\n  }\n\n  async join(cfg: JoinConfig) {\n\n    const server = UrlConfig.getVcxServer().server;\n    const clientId = UrlConfig.getVcxServer().client_id;\n\n    const http: HttpClient = new HttpClient(server, clientId);\n    const ims = new ImsClient(http);\n    const payload = await ims.getMediaConstraints();\n\n    this.gateway.createSession(\n      cfg.server,\n      payload.PC_CONFIG?.iceServers,\n      () => this.attachAndEnsureRoomThenJoin(cfg),\n      () => Logger.setStatus(\"Session destroyed\")\n    );\n  }\n\n  private attachAndEnsureRoomThenJoin(cfg: JoinConfig) {\n\n    this.gateway.attachPublisher(\n      (h: any) => {\n\n        this.plugin = h;\n        this.joinedRoom = false;\n        this.roomCreateAttempted = false;\n        this.selfId = null;\n        this.roster.reset();\n\n        // reset recording\n        this.recording = false;\n        this.currentRecordingId = null;\n        this.bus.emit(\"recording-changed\", false);\n\n        Logger.setStatus(\"Plugin attached. Checking room...\");\n        this.ensureRoomThenJoin(cfg);\n      },\n      (msg: any, jsep: any) => this.onPublisherMessage(cfg, msg, jsep),\n      (track: any, on: any) => {\n        if (on && track.kind === \"video\") {\n          this.media.setLocalTrack(this.localVideo, track);\n        }\n      },\n      () => Logger.setStatus(\"Publisher cleanup\")\n    );\n  }\n\n  private getVideoRoomData(msg: any) {\n    return msg?.plugindata?.data ?? msg;\n  }\n\n  private ensureRoomThenJoin(cfg: JoinConfig) {\n\n    if (!this.plugin) return;\n\n    this.plugin.send({\n      message: { request: \"exists\", room: cfg.roomId },\n      success: (res: any) => {\n\n        const data = this.getVideoRoomData(res);\n        const exists = !!data?.exists;\n\n        if (exists) {\n          Logger.setStatus(`Room exists. Joining...`);\n          this.sendPublisherJoin(cfg);\n        } else {\n          Logger.setStatus(`Room not found. Creating...`);\n          this.roomCreateAttempted = true;\n          this.sendCreateRoom(cfg);\n        }\n      },\n      error: () => this.leave()\n    });\n  }\n\n  private sendPublisherJoin(cfg: JoinConfig) {\n    if (!this.plugin) return;\n    this.plugin.send({\n      message: {\n        request: \"join\",\n        room: cfg.roomId,\n        ptype: \"publisher\",\n        display: cfg.display\n      }\n    });\n  }\n\n  private sendCreateRoom(cfg: JoinConfig) {\n\n    if (!this.plugin) return;\n\n    this.plugin.send({\n      message: {\n        request: \"create\",\n        room: cfg.roomId,\n        publishers: 10,\n        description: `Room ${cfg.roomId}`\n      },\n      success: () => {\n        Logger.setStatus(\"Room created. Joining...\");\n        this.sendPublisherJoin(cfg);\n      },\n      error: () => this.leave()\n    });\n  }\n\n  private onPublisherMessage(cfg: JoinConfig, msg: any, jsep: any) {\n\n    const data = this.getVideoRoomData(msg);\n    const event = data[\"videoroom\"];\n    const errorCode = data[\"error_code\"];\n\n    if (event === \"event\" && errorCode === 426) {\n      if (!this.roomCreateAttempted) {\n        this.roomCreateAttempted = true;\n        this.sendCreateRoom(cfg);\n      } else {\n        this.leave();\n      }\n      return;\n    }\n\n    if (event === \"joined\") {\n\n      this.joinedRoom = true;\n      this.currentRoomId = cfg.roomId;\n\n      const myId = data[\"id\"];\n      this.privateId = data[\"private_id\"];\n      this.selfId = myId;\n      this.roster.setSelf(myId);\n\n      Logger.setStatus(\"Joined. Publishing...\");\n\n      this.remoteFeeds = new RemoteFeedManager(\n        this.gateway.getJanus(),\n        cfg.roomId,\n        this.privateId!,\n        this.gateway.getOpaqueId(),\n        this.media,\n        this.remoteVideo\n      );\n\n      this.publish();\n      this.reconcile(cfg, data[\"publishers\"]);\n      this.bus.emit(\"joined\", true);\n    }\n\n    if (event === \"event\") {\n      this.reconcile(cfg, data[\"publishers\"]);\n\n      const leaving = data[\"leaving\"];\n      if (typeof leaving === \"number\") {\n        this.removeParticipant(cfg, leaving);\n      }\n\n      const unpublished = data[\"unpublished\"];\n      if (typeof unpublished === \"number\") {\n        this.removeParticipant(cfg, unpublished);\n      }\n    }\n\n    if (event === \"destroyed\") {\n      this.leave();\n      return;\n    }\n\n    if (jsep) this.plugin.handleRemoteJsep({ jsep });\n  }\n\n  private reconcile(cfg: JoinConfig, publishers: any) {\n    if (!publishers) return;\n    publishers.forEach((p: any) => {\n      const feedId = Number(p?.id);\n      if (!Number.isFinite(feedId)) return;\n\n      this.roster.add(feedId);\n      if (this.remoteFeeds && feedId !== this.selfId) {\n        this.remoteFeeds.addFeed(feedId);\n      }\n    });\n\n    this.bus.emit(\"participants\", this.roster.snapshot(cfg.roomId));\n  }\n\n  private removeParticipant(cfg: JoinConfig, feedId: number) {\n    if (feedId === this.selfId) return;\n    this.roster.remove(feedId);\n    this.remoteFeeds?.removeFeed(feedId);\n    this.bus.emit(\"participants\", this.roster.snapshot(cfg.roomId));\n  }\n\n  // =====================================\n  // MEDIA\n  // =====================================\n\n  // public publish() {\n  //   this.plugin.createOffer({\n  //     tracks: [\n  //       { type: \"audio\", capture: true, recv: false },\n  //       { type: \"video\", capture: true, recv: false }\n  //     ],\n  //     success: (jsep: any) => {\n  //       this.plugin.send({\n  //         message: { request: \"configure\", audio: true, video: true },\n  //         jsep\n  //       });\n  //     }\n  //   });\n  // }\n\n  public publish() {\n    if (!this.plugin) {\n      Logger.setStatus(\"Publish ignored: plugin not ready\");\n      return;\n    }\n\n    this.plugin.createOffer({\n      tracks: [\n        { type: \"audio\", capture: true, recv: false },\n        { type: \"video\", capture: true, recv: false },\n      ],\n\n      success: (jsep: any) => {\n        //  Point #4: capture and emit connectivity info from RTCPeerConnection\n        try {\n          const pc: RTCPeerConnection | undefined = this.plugin?.webrtcStuff?.pc;\n\n          if (pc) {\n            const emit = () => {\n              const payload = {\n                ice: pc.iceConnectionState,\n                signaling: pc.signalingState,\n                connection: (pc as any).connectionState ?? \"n/a\",\n                gathering: pc.iceGatheringState,\n                ts: Date.now(),\n              };\n\n              console.log(\"VCX_CONNECTIVITY=\", payload);\n              this.bus.emit(\"connectivity\", payload);\n            };\n\n            // emit once immediately\n            emit();\n\n            pc.oniceconnectionstatechange = () => {\n              console.log(\"VCX_ICE=\" + pc.iceConnectionState);\n              emit();\n            };\n\n            pc.onsignalingstatechange = () => {\n              console.log(\"VCX_SIGNALING=\" + pc.signalingState);\n              emit();\n            };\n\n            // connectionState exists on modern browsers; not always present everywhere\n            (pc as any).onconnectionstatechange = () => {\n              console.log(\"VCX_CONNECTION=\" + ((pc as any).connectionState ?? \"n/a\"));\n              emit();\n            };\n\n            pc.onicegatheringstatechange = () => {\n              console.log(\"VCX_GATHERING=\" + pc.iceGatheringState);\n              emit();\n            };\n          } else {\n            console.log(\"VCX_CONNECTIVITY=pc_not_available\");\n            this.bus.emit(\"connectivity\", {\n              ice: \"n/a\",\n              signaling: \"n/a\",\n              connection: \"n/a\",\n              gathering: \"n/a\",\n              ts: Date.now(),\n            });\n          }\n        } catch (e: any) {\n          console.log(\"VCX_CONNECTIVITY=hook_error\", e?.message || e);\n        }\n\n        //  normal Janus publish configure\n        this.plugin.send({\n          message: { request: \"configure\", audio: true, video: true },\n          jsep,\n        });\n      },\n\n      error: (e: any) => {\n        Logger.setStatus(\"Offer error: \" + JSON.stringify(e));\n        console.log(\"VCX_OFFER_ERROR=\", e);\n      },\n    });\n  }\n\n  toggleMute() {\n    if (!this.plugin) return;\n    const m = this.plugin.isAudioMuted();\n    m ? this.plugin.unmuteAudio() : this.plugin.muteAudio();\n    this.bus.emit(\"mute-changed\", !m);\n  }\n\n  stopVideo() {\n    this.plugin?.send({ message: { request: \"unpublish\" } });\n  }\n\n  // =====================================\n  // RECORDING\n  // =====================================\n\n  public startRecording(recordingId: string) {\n\n    if (!this.plugin || !this.joinedRoom) return;\n    if (this.recording) return;\n\n    this.currentRecordingId = recordingId;\n\n    this.plugin.send({\n      message: {\n        request: \"configure\",\n        record: true,\n        room:this.currentRoomId,\n        filename: recordingId\n      },\n      success: () => {\n        this.recording = true;\n        Logger.setStatus(`Recording started: ${recordingId}`);\n        this.bus.emit(\"recording-changed\", true);\n      },\n      error: () => {\n        this.recording = false;\n        this.bus.emit(\"recording-changed\", false);\n      }\n    });\n  }\n\n  public stopRecording() {\n\n    if (!this.plugin || !this.recording) return;\n\n    this.plugin.send({\n      message: { request: \"configure\", record: false },\n      success: () => {\n        this.recording = false;\n        Logger.setStatus(\"Recording stopped\");\n        this.bus.emit(\"recording-changed\", false);\n      }\n    });\n  }\n\n  // =====================================\n  // LEAVE\n  // =====================================\n\n  leave() {\n\n    try {\n\n      if (this.recording) this.stopRecording();\n\n      try {\n        if (this.joinedRoom) {\n          this.plugin?.send({ message: { request: \"leave\" } });\n        }\n      } catch {}\n\n      this.remoteFeeds?.cleanupAll();\n      this.remoteFeeds = null;\n\n      this.plugin = null;\n      this.gateway.destroy();\n\n      this.joinedRoom = false;\n      this.recording = false;\n      this.currentRecordingId = null;\n      this.currentRoomId = null;\n      this.selfId = null;\n      this.roster.reset();\n\n      this.bus.emit(\"recording-changed\", false);\n      this.bus.emit(\"joined\", false);\n\n      this.media.clearLocal(this.localVideo);\n      this.media.clearRemote(this.remoteVideo);\n\n      Logger.setStatus(\"Left\");\n\n    } catch (e: any) {\n      Logger.setStatus(\"Leave error: \" + e.message);\n    }\n  }\n\n    async toggleScreenShare(){\n    if(!this.plugin) return;\n\n    if(!this.screenEnabled){\n      const ss = await this.screenManager.start();\n      const track = ss.getVideoTracks()[0];\n      if(!track) return;\n      this.screenEnabled = true;\n      this.replaceVideoTrack(track);\n      Logger.setStatus(\"Screen share started\");\n      this.bus.emit(\"screen-changed\", true);\n      track.onended = ()=>{ if(this.screenEnabled) this.toggleScreenShare(); };\n    } else {\n      this.screenManager.stop();\n      this.screenEnabled = false;\n      const cam = await this.ensureCameraStream();\n      const track = cam.getVideoTracks()[0];\n      if(track) this.replaceVideoTrack(track);\n      Logger.setStatus(\"Screen share stopped\");\n      this.bus.emit(\"screen-changed\", false);\n    }\n  }\n\n  async toggleVirtualBackground(){\n    if(!this.plugin) return;\n    if(this.screenEnabled){\n      Logger.setStatus(\"Disable screen share before virtual background\");\n      return;\n    }\n\n    if(!this.vbEnabled){\n      const cam = await this.ensureCameraStream();\n      const processed = await this.vbManager.enable(cam);\n      const track = processed.getVideoTracks()[0];\n      if(!track) return;\n      this.vbEnabled = true;\n      this.replaceVideoTrack(track);\n      this.bus.emit(\"vb-changed\", true);\n    } else {\n      this.vbManager.disable();\n      this.vbEnabled = false;\n      const cam = await this.ensureCameraStream();\n      const track = cam.getVideoTracks()[0];\n      if(track) this.replaceVideoTrack(track);\n      this.bus.emit(\"vb-changed\", false);\n    }\n  }\n  private async ensureCameraStream(){\n    if(!this.cameraStream){\n      this.cameraStream = await navigator.mediaDevices.getUserMedia({ video:true, audio:true });\n    }\n    return this.cameraStream;\n  }\n   private replaceVideoTrack(track: MediaStreamTrack){\n    if(!this.plugin) return;\n    this.plugin.replaceTracks({\n      tracks:[{ type:\"video\", capture:track, recv:false }]\n    });\n    this.media.setLocalTrack(this.localVideo, track);\n  }\n}\n","// import {Dom} from \"./Dom\";\n// import {CallController} from \"../managers/CallController\";\n\nclass UIController {\n\n  private getQueryParam(key: string): string | null {\n    try {\n      return new URLSearchParams(window.location.search).get(key);\n    } catch {\n      return null;\n    }\n  }\n\n  private logger: Logger;\n  private bus = new EventBus();\n  private controller: CallController;\n\n  private btnMute = document.getElementById(\"btnMute\") as HTMLButtonElement;\n  private btnUnpublish = document.getElementById(\"btnUnpublish\") as HTMLButtonElement;\n  private btnLeave = document.getElementById(\"btnLeave\") as HTMLButtonElement;\n  private btnReconnect = document.getElementById(\"btnReconnect\") as HTMLButtonElement;\n  private btnScreen = document.getElementById(\"btnScreen\") as HTMLButtonElement;\n  private btnVB = document.getElementById(\"btnVB\") as HTMLButtonElement;\n\n  //  NEW\n  private btnRecord = document.getElementById(\"btnRecord\") as HTMLButtonElement;\n\n  private lastCfg: JoinConfig | null = null;\n\n  private bridge = new ParentBridge();\n  private net = new NetworkQualityManager();\n\n  private localOverlay = document.getElementById(\"localOverlay\") as HTMLDivElement;\n  private remoteOverlay = document.getElementById(\"remoteOverlay\") as HTMLDivElement;\n  private endedOverlay = document.getElementById(\"endedOverlay\") as HTMLDivElement;\n\n  private localQ = document.getElementById(\"localQuality\") as HTMLDivElement;\n  private remoteQ = document.getElementById(\"remoteQuality\") as HTMLDivElement;\n  private localQD = document.getElementById(\"localQualityDetails\") as HTMLDivElement;\n  private remoteQD = document.getElementById(\"remoteQualityDetails\") as HTMLDivElement;\n\n  private audioMuted = false;\n  private videoMuted = false;\n  private ended = false;\n  private folderPath:string = \"/opt/efs-janus-app/dev/VideoRecDownloads\";\n  private autoRecordParticipantThreshold = 2;\n\n  //  recording state\n  private recording = false;\n\n  constructor() {\n    const qn = this.getQueryParam(\"name\");\n    if (qn) Logger.setUserName(qn);\n\n    Logger.user(\"UI loaded. Initializing controllers...\");\n    Logger.flow(\"DOMContentLoaded  UIController()\");\n\n    this.logger = new Logger(\n      document.getElementById(\"statusLine\") as HTMLElement,\n      document.getElementById(\"sessionInfo\") as HTMLElement\n    );\n\n    const localVideo = document.getElementById(\"localVideo\") as HTMLVideoElement;\n    const remoteVideo = document.getElementById(\"remoteVideo\") as HTMLVideoElement;\n\n    this.controller = new CallController(this.bus, localVideo, remoteVideo);\n\n    this.bus.on<boolean>(\"joined\", j=>{\n        this.setJoinedState(j);\n        console.log(\"VCX_JOINED=\" + j);\n        this.updateDebugState({\n          joined: j\n        });\n    });\n\n    this.bus.on<boolean>(\"mute-changed\", muted => {\n      this.btnMute.innerHTML =\n        muted\n          ? '<i class=\"fa-solid fa-microphone-slash\"></i>'\n          : '<i class=\"fa-solid fa-microphone\"></i>';\n    });\n\n    this.bus.on<boolean>(\"screen-changed\", on => {\n      this.btnScreen.title = on ? \"Stop Screen Share\" : \"Start Screen Share\";\n    });\n\n    this.bus.on<boolean>(\"vb-changed\", on => {\n      this.btnVB.title = on ? \"Disable Virtual Background\" : \"Enable Virtual Background\";\n    });\n    this.bus.on<boolean>(\"recording-changed\", isRecording => {\n        this.recording = isRecording;\n        this.updateRecordUI();\n        this.updateDebugState({\n          recording: isRecording\n        });\n        this.bridge.emit({\n          type: \"RECORDING_CHANGED\",\n          recording: isRecording\n        });\n    });\n\n    this.bus.on<any>(\"participants\", (snapshot) => {\n        const count = snapshot.participantIds.length;\n        Logger.user(`Participants count: ${count}`);\n        // SIMPLE LOG (automation-friendly)\n        console.log(\"VCX_PARTICIPANTS=\" + count);\n        this.updateDebugState({\n          participants: count\n        });\n        this.syncAutoRecordingByParticipants(count);\n    });\n    this.bus.on<any>(\"connectivity\", (s) => {\n        this.updateDebugState({\n          iceState: s.ice,\n          signalingState: s.signaling,\n          connectionState: s.connection\n        });\n    });  \n\n    this.wire();\n    this.setupNetworkUI();\n    this.setupParentBridge();\n    this.autoJoin();\n  }\n\n  private wire() {\n\n    // AUDIO\n    this.btnMute.onclick = () => {\n      Logger.user(\"Audio button clicked  toggle mute\");\n      this.controller.toggleMute();\n\n      this.audioMuted = !this.audioMuted;\n      this.btnMute.classList.toggle(\"danger\", this.audioMuted);\n\n      this.localOverlay.innerText =\n        this.audioMuted ? \"audio muted\" : \"Local\";\n\n      this.remoteOverlay.innerText =\n        this.audioMuted\n          ? \"audio muted on other participant\"\n          : \"Remote\";\n\n      this.bridge.emit({ type: \"AUDIO_MUTED\", muted: this.audioMuted });\n    };\n\n    // VIDEO\n    this.btnUnpublish.onclick = () => {\n      Logger.user(\"Video button clicked\");\n\n      this.videoMuted = !this.videoMuted;\n      this.btnUnpublish.classList.toggle(\"danger\", this.videoMuted);\n\n      if (this.videoMuted) {\n        this.controller.stopVideo();\n      } else {\n        // republish\n        this.controller.publish();\n      }\n\n      this.localOverlay.innerText =\n        this.videoMuted ? \"video muted\" : \"Local\";\n\n      this.remoteOverlay.innerText =\n        this.videoMuted\n          ? \"video muted on other participant\"\n          : \"Remote\";\n\n      this.bridge.emit({ type: \"VIDEO_MUTED\", muted: this.videoMuted });\n    };\n\n    // LEAVE / START\n    this.btnLeave.onclick = () => {\n\n      if (!this.ended) {\n        Logger.user(\"End button clicked\");\n        this.controller.leave();\n\n        this.ended = true;\n        this.endedOverlay.style.display = \"flex\";\n\n        this.btnLeave.innerHTML =\n          '<i class=\"fa-solid fa-play\"></i>';\n        this.btnLeave.title = \"Start\";\n\n        this.bridge.emit({ type: \"CALL_ENDED\" });\n      } else {\n        Logger.user(\"Start button clicked\");\n        this.autoJoin();\n      }\n    };\n\n    this.btnReconnect.onclick = () => this.reconnect();\n\n    this.btnScreen.onclick =\n      () => this.controller.toggleScreenShare();\n\n    this.btnVB.onclick =\n      () => this.controller.toggleVirtualBackground();\n\n    //  RECORD BUTTON\n    if (this.btnRecord) {\n      this.btnRecord.onclick = () => {\n        if (this.recording) {\n          this.stopRecording(\"manual\");\n        } else {\n          this.startRecording(\"manual\");\n        }\n      };\n    }\n  }\n\n  private syncAutoRecordingByParticipants(participantCount: number) {\n    const shouldRecord = participantCount >= this.autoRecordParticipantThreshold;\n\n    if (shouldRecord && !this.recording) {\n      this.startRecording(\"auto\");\n      return;\n    }\n\n    if (!shouldRecord && this.recording) {\n      this.stopRecording(\"auto\");\n    }\n  }\n\n  private startRecording(source: \"manual\" | \"auto\") {\n    if (this.recording) return;\n\n    const rid = this.createRecordingId();\n    Logger.user(`${source} start recording`);\n    this.controller.startRecording(rid);\n  }\n\n  private stopRecording(source: \"manual\" | \"auto\") {\n    if (!this.recording) return;\n\n    Logger.user(`${source} stop recording`);\n    this.controller.stopRecording();\n  }\n\n  private createRecordingId(): string{\n    // Generate 6 digit integer (100000  999999)\n    const recordingId = Math.floor(100000 + Math.random() * 900000);\n    // Build Janus recording basename\n    const rid = `${this.folderPath}/${recordingId}/rec_${Date.now()}`;\n    Logger.user(`Recording generated  id=${recordingId}, rid=${rid}`);\n    return rid;\n  }\n\n  private updateRecordUI() {\n    if (!this.btnRecord) return;\n\n    if (this.recording) {\n      this.btnRecord.classList.add(\"danger\");\n      this.btnRecord.innerHTML =\n        '<i class=\"fa-solid fa-stop\"></i>';\n      this.btnRecord.title = \"Stop Recording\";\n    } else {\n      this.btnRecord.classList.remove(\"danger\");\n      this.btnRecord.innerHTML =\n        '<i class=\"fa-solid fa-circle\"></i>';\n      this.btnRecord.title = \"Start Recording\";\n    }\n  }\n\n  private autoJoin() {\n    const cfg = UrlConfig.buildJoinConfig();\n    this.lastCfg = cfg;\n    this.recording = false;\n    this.updateRecordUI();\n\n    Logger.setStatus(\n      `Joining... roomId=${cfg.roomId}, name=${cfg.display}`\n    );\n\n    this.ended = false;\n    this.endedOverlay.style.display = \"none\";\n\n    this.btnLeave.innerHTML =\n      '<i class=\"fa-solid fa-phone-slash\"></i>';\n    this.btnLeave.title = \"End\";\n\n    this.controller.join(cfg);\n    this.bridge.emit({ type: \"CALL_STARTED\" });\n  }\n\n  private reconnect() {\n    if (!this.lastCfg) return;\n\n    this.controller.leave();\n\n    // safer Janus reconnect\n    setTimeout(() => {\n      this.controller.join(this.lastCfg!);\n    }, 800);\n  }\n\n  private setJoinedState(joined: boolean) {\n    [\n      this.btnMute,\n      this.btnUnpublish,\n      this.btnLeave,\n      this.btnReconnect,\n      this.btnScreen,\n      this.btnVB,\n      this.btnRecord\n    ].forEach(b => b && (b.disabled = !joined));\n  }\n\n  private setupNetworkUI() {\n    const toggle = (el: HTMLElement) =>\n      el.classList.toggle(\"show\");\n\n    this.localQ.onclick = () => toggle(this.localQD);\n    this.remoteQ.onclick = () => toggle(this.remoteQD);\n\n    this.net.start((l, r, d) => {\n      this.localQ.textContent = `Local: ${l}`;\n      this.remoteQ.textContent = `Remote: ${r}`;\n      this.localQD.textContent = d;\n      this.remoteQD.textContent = d;\n\n      Logger.net(`Local ${l} | Remote ${r} | ${d}`);\n\n      this.bridge.emit({\n        type: \"NETWORK_CHANGED\",\n        local: l,\n        remote: r\n      });\n    });\n  }\n\n  private setupParentBridge() {\n    this.bridge.onCommand((cmd: any) => {\n      switch (cmd.type) {\n        case \"START_CALL\":\n          this.controller.join(this.lastCfg!);\n          break;\n\n        case \"STOP_CALL\":\n          this.controller.leave();\n          break;\n\n        case \"TOGGLE_AUDIO\":\n          this.btnMute.click();\n          break;\n\n        case \"TOGGLE_VIDEO\":\n          this.btnUnpublish.click();\n          break;\n\n        case \"RECONNECT\":\n          this.reconnect();\n          break;\n\n        //  recording events\n        case \"START_RECORDING\":\n          this.startRecording(\"manual\");\n          break;\n\n        case \"STOP_RECORDING\":\n          this.stopRecording(\"manual\");\n          break;\n\n        case \"TOGGLE_RECORDING\":\n          this.btnRecord.click();\n          break;\n      }\n    });\n  }\n  private updateDebugState(extra:any = {}) {\n    const dbg = (window as any).__vcxDebug || {};\n    (window as any).__vcxDebug = {\n      ...dbg,\n      ...extra,\n      timestamp: Date.now()\n    };\n\n    console.log(\"VCX_DEBUG\", (window as any).__vcxDebug);\n  }\n}\n","// src/app.ts\n// import {UIController} from \"./ui/UIController\";\nwindow.addEventListener(\"DOMContentLoaded\", () => {\n    console.log(\"page loaded\")\n     new UIController(); \n});\n"]}